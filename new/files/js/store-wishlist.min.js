var headers = {
    Accept: "application/vnd.vtex.ds.v10+json",
    "Content-Type": "application/json",
  },
  isWishListPage = $("body").hasClass("wishlist"),
  documentClientId = "",
  wishlistStoreName = "tfbttg";
function onWishListEmpty() {
  $("body").addClass("x-active"),
    $(".x-wishlist-list, .js--wishlist-shelfs").empty(),
    $(".x-wrap-center-content__message").show(),
    $(".x-wishlist-page__not-found").show();
}
function wishlist() {
  $("body").on("click", ".btn-like.js-btn-like", function () {
    if ($("body").hasClass("user-logged")) {
      var s = $(this).attr("id");
      return (
        !!s && ($(this).addClass("x-loading"), saveOnWishlist($(this), s), !1)
      );
    }
    window.location.href = "/login";
  }),
    $(
      ".product__actions__prod .btn-like.js-btn-like, .x-look-picklist__wishlist"
    ).on("click", function () {
      return (
        !!skuJson &&
        ($(this).addClass("x-loading"),
        saveOnWishlist($(this), skuJson.productId),
        !1)
      );
    });
}
function saveOnWishlist(s, i) {
  var e = s,
    t = i;
  $.ajax({
    type: "GET",
    url: "/no-cache/profileSystem/getProfile",
    success: function (s) {
      var i = s.Email;
      if (1 == s.IsUserDefined) {
        if (
          (addProductWishlist.apply(e, [t, i]),
          null == $.cookie("wishlist") || "undefined" == $.cookie("wishlist"))
        )
          $.cookie("wishlist", t, { path: "/", expires: 1 });
        else {
          var o = $.cookie("wishlist").split(/,/);
          if (-1 != o.indexOf(t)) var n = $.cookie("wishlist") + "," + t;
          else {
            n = o.remove(t);
            n = "".concat(n);
          }
          $.cookie("wishlist", n, { path: "/", expires: 1 });
        }
        wishlistSelectedsCookie();
      } else $(".x-add-it-to-wishlist").css("display", "none");
    },
    error: function (s) {
      console.log("Ops, ocorreu um erro.");
    },
  });
}
function addProductWishlist(s, i) {
  $(this).each(function () {
    var e = $(this),
      t = !0,
      o = { userId: i, productsList: "" },
      n = "",
      r = "";
    $.ajax({
      headers: headers,
      type: "GET",
      url: "/api/dataentities/CL/search?_where=email=" + i + "&_fields=id",
      success: function (i) {
        $(i).length &&
          ((n = i[0].id),
          $.ajax({
            headers: headers,
            type: "GET",
            url:
              "/api/dataentities/PD/search?_where=userId=" +
              n +
              "&_fields=id,productsList",
            success: function (i) {
              if (i[0]) {
                var n = i[0].productsList;
                n && -1 != n.indexOf(",") && (n = n.split(/,/)), (r = i[0].id);
              }
              var a;
              n
                ? -1 == n.indexOf(s.toString())
                  ? (o.productsList = n + "," + s)
                  : (Array.isArray(n)
                      ? (n.remove(s.toString()),
                        (o.productsList = "".concat(n)))
                      : (o.productsList = ""),
                    (t = !1))
                : (o.productsList = s);
              (a = "/api/dataentities/PD/documents/" + r),
                $.ajax({
                  headers: headers,
                  data: JSON.stringify(o),
                  type: "PATCH",
                  url: a,
                  success: function (s) {
                    e.removeClass("x-loading"),
                      t ? e.addClass("is-wished") : e.removeClass("is-wished"),
                      wishlistSelecteds();
                  },
                  error: function (s) {
                    console.log("Ops, ocorreu um erro.");
                  },
                });
            },
          }));
      },
      error: function (s) {
        console.log(s);
      },
    });
  });
}
function wishlistSelecteds() {
  $.ajax({
    type: "GET",
    url: "/no-cache/profileSystem/getProfile",
    success: function (s) {
      var i = s.Email;
      1 == s.IsUserDefined &&
        1 == s.IsUserDefined &&
        $.ajax({
          headers: headers,
          type: "GET",
          url: "/api/dataentities/CL/search?_where=email=" + i + "&_fields=id",
          success: function (s) {
            if ($(s).length) {
              var i = s[0].id;
              (documentClientId = s[0].id),
                $.ajax({
                  headers: headers,
                  type: "GET",
                  url:
                    "/api/dataentities/PD/search?_where=userId=" +
                    i +
                    "&_fields=id,productsList",
                  success: function (s) {
                    if ($(s).length && s[0].productsList) {
                      var i = s[0].productsList.split(/,/g);
                      if (
                        ($(".js--wishlist-shelfs").attr("data-list", s[0].id),
                        i[0])
                      ) {
                        var e = i.length,
                          t = i
                            .filter(function (s) {
                              return $.trim(s);
                            })
                            .map(function (s) {
                              return "fq=productId:" + s;
                            })
                            .join("&");
                        if (isWishListPage) {
                          var o =
                            ($(window).width(),
                            "5621566c-8520-4b82-a0fa-6592ed2fdcef");
                          $.ajax(
                            "/buscapagina?" +
                              t +
                              "&PS=" +
                              e +
                              "&sl=" +
                              o +
                              "&cc=100&sm=0&PageNumber=1",
                            { async: !1 }
                          )
                            .done(function (s) {
                              $(".js--wishlist-shelfs").html(s),
                                $("body").addClass("x-active");
                            })
                            .fail(function () {
                              onWishListEmpty();
                            });
                        }
                        setTimeout(function () {
                          for (var s = 0; s < i.length; s++)
                            setWishedProducts(i[s]);
                        }, 100);
                      } else onWishListEmpty();
                    } else onWishListEmpty();
                  },
                  error: function (s) {
                    console.log(s);
                  },
                });
            }
          },
          error: function (s) {
            console.log(s);
          },
        });
    },
    error: function (s) {
      console.log("Ops, ocorreu um erro."), console.log("Error: ", s);
    },
  });
}
function wishlistSelectedsCookie() {
  if (null != $.cookie("wishlist"))
    for (var s = $.cookie("wishlist").split(","), i = 0; i < s.length; i++) {
      setWishedProducts(s[i]);
    }
}
function setWishedProducts(s) {
  $(".product .btn-like.js-btn-like").each(function () {
    $(this).attr("id") == s && $(this).addClass("is-wished");
  });
}
function deleteItemWishlist() {
  $("body").on("click", ".x-wishlist-delete", function (s) {
    var i = $(this).closest("li"),
      e = $(".js--wishlist-shelfs").attr("data-list"),
      t = i.attr("data-id");
    return (
      $.ajax({
        headers: headers,
        type: "GET",
        url:
          "/api/dataentities/PD/search?_where=id=" +
          e +
          "&_fields=userId,productsList",
        success: function (s) {
          var o = s[0].productsList.split(/,/g),
            n = o.indexOf(t);
          o.splice(n, 1);
          var r = { productsList: (o = o.length && o[0] ? o.join(",") : ",") },
            a = "/api/dataentities/PD/documents/" + e;
          $.ajax({
            headers: headers,
            data: JSON.stringify(r),
            type: "PATCH",
            url: a,
            success: function (s) {
              $(i).slideUp(300, function () {
                i.remove();
              }),
                $.cookie("wishlist", "");
            },
            error: function (s) {
              console.log("Ops, ocorreu um erro.");
            },
          });
        },
        error: function (s) {
          console.log(s);
        },
      }),
      !1
    );
  });
}
function itensAddList() {
  $('.vitrine.prateleira >ul>li input[name="buy_whish"]').live(
    "click",
    function () {
      var s = 0;
      $.each(
        $(
          '.dd-m-list.dd-m-list-wish .vitrine.prateleira >ul>li input[name="buy_whish"]:checked'
        ),
        function () {
          s++;
        }
      ),
        $("p.itens_cart_whish span").html(s);
    }
  );
}
function addListCart() {
  $("a.btn__buy__whishlist").live("click", function () {
    var s = "/checkout/cart/add?",
      i = "";
    $.each(
      $(
        '.dd-m-list.dd-m-list-wish .vitrine.prateleira >ul>li input[name="buy_whish"]:checked'
      ),
      function () {
        (i = $(this).val()),
          (s += "&sku=" + i + "&qty=1&seller=1&redirect=true&sc=1");
      }
    ),
      "" == i
        ? alert(
            "Selecione os produtos que tem interesse em colocar no carrinho!"
          )
        : (window.location.href = s);
  });
}
$(document).ready(function () {
  wishlist(),
    wishlistSelecteds(),
    wishlistSelectedsCookie(),
    deleteItemWishlist(),
    isWishListPage && (itensAddList(), addListCart());
});
